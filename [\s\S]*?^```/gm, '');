
    // Final cleaning: trim and remove excessive whitespace
    cleaned = cleaned.trim();

    // Parse JSON
    const parsed = JSON.parse(cleaned);
    return parsed;

  } catch (error) {
    console.log("[extractJSON] Error during JSON extraction:", error);
    // fallback: try JSON.parse(content) directly
    try {
      return JSON.parse(content);
    } catch (err) {
      console.warn("[extractJSON] Fallback json parse failed:", err);
      return null;
    }
  }
}
