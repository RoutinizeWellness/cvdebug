const freeUsers = await ctx.db.query("users").withIndex("by_subscription_tier", q => q.eq("subscriptionTier", "free")).collect();

        let newTier: "single_scan" | "bulk_pack" = "single_scan";
        if ((user.credits || 0) >= 7) {
          newTier = "bulk_pack";
        }